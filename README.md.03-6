#devops-netology
03-sysadmin-06-net

1. Необязательное задание: можно посмотреть целый фильм в консоли telnet towel.blinkenlights.nl :)
Ответ: посмотрел)

2. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.

Ответ: 1, 6 и 11 каналы не пересекаются по частотам при ширине в 20 МГц для 2.4 ГГц. Для 5 ГГц это могут быть 36, 40, 44, 48, 52, 56, 60, 64 каналы. 

3. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC 38:f9:d3:55:55:79?

Ответ: 38-f9-d3 Apple, Inc.

4. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?

Ответ: Payload это MTU минус заголовок TCP минус заголовок IP, таким образом: 9001-20-32=8949 байт.

5. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?

Ответ: Флаг SYN - установка соединения, а FIN - завершение соединения. Соответственно при штатной работе оба флага одновременно использовать недопустимо.

6. ss -ula sport = :53 на хосте имеет следующий вывод:

State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:
Почему в State присутствует только UNCONN, и может ли там присутствовать, например, TIME-WAIT?

Ответ: ss с аргументом -u означает отображение сокетов udp-протокола. TIME_WAIT же используется в протоколе TCP для подтверждения закрытия соединения, которое не используется для UDP. Поэтому, нет, не может.  

7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.

Ответ:
инициатор		ответчик
fin		->	fin
			CLOSING
ack		<-	ack	
FIN WAIT 1		CLOSE WAIT
fin		<-	fin
FIN WAIT 2		
fin/ack		->	fin/ack
			TIME WAIT
			CLOSE

8. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?

Ответ: Максимальное количество портов 65535, следовательно 65535 параллельных соединений от клиента к серверу. В случае, если клиентов больше одного, то по 65535 соединений на клиента, но зависит от количества файловых дескрипторов на сервере.

9. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии TIME-WAIT? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.

Ответ: Соединение в состоянии TIME-WAIT занимает порт. Таким образом, уменьшается доступность соединений с сервером. Но нужно смотреть по ситуации. Если количество портов ограничено, то большое количество таких соединений - плохо.

10. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

Ответ: UDP-протокол не позволяет контролировать корректность получения данных. Соответственно при сбоях передачи возможны потери информации. В связи с тем, что UDP не поддерживает сессии, в отличие от TCP, информация может приходить "хаотично". Возможно, это не проблема, если в использующей UDP программе хорошо реализована обработка данных с учетом особенностей UDP.

11. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.

Ответ: Я бы использовал TCP, как протокол с гарантированной доставкой. Текстовые логи не занимают большого объема канала и ресурсов, но корректность данных критична. Syslog использует UDP, что не гарантирует доставку, а также у Syslog нет стандарта форматирования. Однако, возможно использование TCP(1468) для Syslog, что снимает часть недостатков.

12. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?

Ответ: команда ss с опциями -t (TCP) -p (process):
vagrant@vagrant:~$ sudo ss state listening -t -p
Recv-Q  Send-Q   Local Address:Port       Peer Address:Port  Process
0       4096           0.0.0.0:sunrpc          0.0.0.0:*      users:(("rpcbind",pid=556,fd=4),("systemd",pid=1,fd=35))
0       4096     127.0.0.53%lo:domain          0.0.0.0:*      users:(("systemd-resolve",pid=557,fd=13))
0       128            0.0.0.0:ssh             0.0.0.0:*      users:(("sshd",pid=850,fd=3))
0       4096              [::]:sunrpc             [::]:*      users:(("rpcbind",pid=556,fd=6),("systemd",pid=1,fd=37))
0       128               [::]:ssh                [::]:*      users:(("sshd",pid=850,fd=4))*

13. Какой ключ нужно добавить в tcpdump, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?

Ответ: tcpdump -A для вывода текста ASCII, -x или -xx для вывода в HEX и ASCII.

14. Попробуйте собрать дамп трафика с помощью tcpdump на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов -c 100). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?

Ответ: tcpdump -i eth0 -tttt -c 100 -w file.pcap
Флаги IP существуют следующие:
bit 0: Reserved; must be zero.[b]
bit 1: Don't Fragment (DF)
bit 2: More Fragments (MF)
В своем дампе нашел:
Flags: 0x40, Don't fragment
Стандарт Ethernet II:
Ethernet II, Src: PcsCompu_e3:90:c5 (08:00:27:e3:90:c5), Dst: RealtekU_12:35:02 (52:54:00:12:35:02)
OUI есть в source и destination ethernet фрейма в строке выше.
